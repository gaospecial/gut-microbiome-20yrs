# 肠道菌群与疾病 {#disease}

在这一章节，我们将分析最常见的十余种与肠道菌群相关的疾病研究的概况。

## 疾病类型概览

```{r}
disease <- list(cancer_keywords,cardio_keywords,ibd_keywords,ibs_keywords,
                                                   alzheimer_keywords,autism_keywords,hepatology_keywords,
                                                   allergy_keywords,obesity_keywords,diabetes_keywords,asthma_keywords,
                                                  diarrhea_keywords,constipation_keywords)
disease_name <- c("cancer","CVD","IBD","IBS","Alzheimer's","autism","hepatology","allergy","obesity","diabetes","asthma","diarrhea","constipation")
disease_name_cn <- c("肿瘤","心血管","炎症性肠病","肠易激综合征","阿尔兹海默症","自闭症","肝病","过敏","肥胖","糖尿病","哮喘","腹泻","便秘")
names(disease_name_cn) <- disease_name
```



一共有 `r length(disease_name)` 中不同的疾病纳入了我们的分析之中。
它们分别是：`r paste0(disease_name_cn, collapse="、")` 等。

通过比较常见的与肠道菌群相关疾病的研究论文数量，可以得到最受关注的疾病类型分别是：
肿瘤、肥胖、炎症性肠病、心血管疾病、糖尿病等（图 \@ref(fig:disease-research-count)）。


```{r}
disease_subtopic_core_article <- lapply(disease, function(keyword){
  MC_HC_article %>%
    filter(str_detect(content, regex(paste0(c(keyword$primary),collapse = "|"), ignore_case = T))) %>%
    mutate(DT=factor(DT))
})

names(disease_subtopic_core_article) <- disease_name

disease_subtopic_core_article_count <- lapply(disease_subtopic_core_article, function(article){
  article %>% group_by(PY) %>%
    summarise(nRecord = n())
})
```

```{r disease-research-count, fig.cap="过去20年在WoS数据库中收录的肠道菌群研究中，与10多种疾病相关的关键论文数量"}
count <- sapply(disease_subtopic_core_article, nrow)
count <- data.frame(disease=disease_name_cn, count=count)
count <- count %>% arrange(desc(count)) %>%
  mutate(disease=  fct_rev(as_factor(as.character(disease))))
count$angle <- 1:length(disease_name) * 360 / length(disease_name)
ggplot(count, aes(disease,count,fill=count)) + 
  geom_col(width = 0.9) +
  geom_col(aes(y=I(2)),width = 1,fill="white") +
  geom_text(aes(label=disease,y=count*0.85),color="white",vjust=0.5,size=3,fontface="bold",data = function(d) d[d$count>3000,]) +
  geom_text(aes(label=disease,y=count*1.02),color="black",vjust=0,hjust=0,size=3,fontface="bold",data = function(d) d[d$count<3000,]) +
  annotate(geom="text",y=800,x=1,label="数据分析：热心肠研究院",color="grey",size=3,hjust=0.9,vjust=1) +
  labs(x="",y="",title = "") +
  coord_flip() +
  scale_fill_gradientn(colors=c("darkgreen","green","orange","firebrick","red"),trans="sqrt") +
  # coord_polar(direction = -1) +
  # theme_void() +
  theme(legend.position = "none",
        axis.text.y = element_blank())

# graph2ppt()

# count
```
这10多种疾病之间的联系，可以从图 \@ref(fig:diet-id-top30) 中窥其一斑。


```{r disease-overlap, fig.cap="10多种疾病之间的重叠度"}
# 不同疾病文献间的重叠度
SR <- lapply(disease_subtopic_core_article, function(d) d %>% pull(SR))
names(SR) <- disease_name_cn
library(UpSetR)

# 这个重叠度就比较低
upset(fromList(SR),
      keep.order = F,
      sets = disease_name_cn,
      mb.ratio = c(0.5,0.5))  

```

```{r}

# 针对疾病章节提取文章
disease_dt_output <- function(name){
  topic_cn <- disease_name_cn[[name]]
  topic_caption <- paste(topic_cn, "相关的关键论文")
  df <- biblio_df(disease_subtopic_core_article[[name]]) %>% 
    filter(CORE==TRUE | HC==TRUE)
  widget <- produce_topic_article_datatable(df, caption = topic_caption, filename = topic_caption)
  print(widget)
  return(df)
}
```





## 心血管疾病

**定义**

心血管疾病是一组心脏和血管疾患的名称，包括：

- 高血压（血压升高），hypertension (high blood pressure)
- 冠心病（心脏病发作），coronary heart disease (heart attack)
- 脑血管疾病（中风），cerebrovascular disease (stroke)
- 周围血管疾病，peripheral vascular disease
- 心力衰竭，heart failure
- 风湿性心脏病，rheumatic heart disease
- 先天性心脏病，congenital heart disease
- 心肌病，cardiomyopathies.

**重要事实**

- 心血管疾病是全球的头号死因：每年死于心血管疾病的人数多于其它任何病因。
- 估计在2012年有1750万人死于心血管疾病，占全球死亡总数的31％。这些死者中，估计740万人死于冠心病，670万人死于中风。
- 四分之三以上的心血管疾病死亡发生在低收入和中等收入国家。
- 大多数心血管疾病可以通过面向全民的战略解决诸如烟草使用、不健康饮食和肥胖、缺乏身体活动和有害使用酒精等危险因素而得到预防。


```{r}
cvd <- disease_dt_output("CVD")
cvd_cn <- cvd %>% filter(str_detect(AU_CO_NR,"CHINA"))
```



```{r}
four_dimension_barplot_caption <- paste0("心血管疾病",
                                         "相关研究的简要信息。",
                                         "（A）发表文章最多的10个国家；",
                                         "（B）发表文章最多的10家机构；",
                                         "（C）发表文章最多的10位科学家；",
                                         "（D）发表文章最多的10本杂志。")
```


```{r cvd-four-dimension-barplot, fig.cap=four_dimension_barplot_caption}
four_dimension_barplot(cvd)
```


```{r}
histPlot(histNetwork(cvd %>% filter(DT == "ARTICLE")))
```



```{r}
d1 <- tableTag(cvd,Tag = "J9") %>% enframe() %>%
  mutate(name=as_factor(as.character(name)),group="count") %>%
  head(30) 

d2 <- cvd %>% group_by(J9) %>% summarise(total_IF=sum(impact_factor), value=n()) %>%
  arrange(desc(total_IF)) %>%
  mutate(name=as_factor(as.character(J9)),group="IF") %>%
  select(-J9) %>%
  head(30) 

uniq_J9 <- unique(c(as.character(d1$name),as.character(d2$name))) 
colors <- colorRampPalette( RColorBrewer::brewer.pal(5,"Blues")[3:5])(length(uniq_J9))
color_set <- data.frame(name=uniq_J9,color=colors) 

d1 <- d1 %>% 
  left_join(color_set)
d2 <- d2 %>%
  left_join(color_set)
```


```{r cvd-J9, fig.cap="心血管疾病研究的主要发文期刊",fig.asp=0.5}

 
p1 <-  ggplot(d1,aes(fct_rev(as_factor(name)),value,fill=I(color))) +
  geom_col() +
  labs(x="",y="No. of record",title = "文章数量Top30") +
  coord_flip()


p2 <- ggplot(d2,aes(fct_rev(as_factor(name)),total_IF,fill=I(color))) +
  geom_col() +
  labs(x="",y="sum of impact factor",title = "累计影响因子Top30") +
  coord_flip()

plot_grid(p1,p2,ncol = 2)

# graph2ppt( plot_grid(p1,p2,ncol = 2), append=TRUE)

```

```{r}
tableTag_barplot(cvd, Tag="AU_CO_NR",n=15)
graph2ppt(append=TRUE)

```



```{r}
country_network(cvd,edge_weight_cutoff = 15)
```


```{r}
tableTag_barplot(cvd, Tag = "AU_UN_NR")

# graph2ppt( p1, append=TRUE)
```
```{r}

tableTag_barplot(cvd_cn,n=15,Tag = "AU_UN_NR")
# graph2ppt( append=TRUE)

```


```{r}
university_network(cvd,  from = 2010,to=2020,nNode = 30,edge_weight_cutoff = 3)
```



```{r}
university_network(cvd_cn,  from = 2010,to=2020,nNode = 15,edge_weight_cutoff = 2)
```

```{r}
tableTag_barplot(cvd,Tag = "AU")
# graph2ppt( append=TRUE)

```
```{r}
author_network(cvd,from = 2010,nNode = 100)
```
```{r}
tableTag_barplot(cvd_cn,Tag = "AU",n=15)
# graph2ppt( append=TRUE)

```


```{r}
author_network(cvd_cn,from = 2010,to=2019,nNode = 15,edge_weight_cutoff = 2)
```




```{r}
tableTag_barplot(cvd,Tag = "ID")
# graph2ppt( append=TRUE)

```


```{r}
keyword_network(cvd, from = 2010,to=2020,nNode = 50,edge_weight_cutoff = 20)
```



## 核心(研究）论文引用历史脉络


```{r}
safe_histNetwork <- purrr::possibly(histNetwork, NULL)
hist_result <- safe_histNetwork(filter(df,DT=="ARTICLE"),verbose = FALSE)
safe_histPlot <- purrr::possibly(histPlot,NULL)
safe_histPlot(hist_result,verbose = F,n=30,size = 8,labelsize = 3)
```

## 领域内专家  


```{r}
topAU <- authorProdOverTime(df, k=10, graph = TRUE)
```


## 作者合作网络

```{r}
# Author collaboration
author_network(df,nNode = 30)
```


## 机构合作网络


```{r disease-article-university-collaboration-network, fig.cap="疾病相关研究机构合作网络"}
## 机构合作网络（显示前 15 家）
university_network(df, nNode = 30, edge_weight_cutoff = 3)
```

## 共词分析

```{r}
keyword_network(df,nNode = 50,edge_weight_cutoff = 10)
```


```{r}
# 共词分析
safe_conceptualStructure <- possibly(conceptualStructure,NULL)
CS <- safe_conceptualStructure(df, field = "AB", method = "MDS",clust=5, minDegree = round(nrow(df)/5), stemming = FALSE, labelsize = 10, documents = 30,graph = FALSE)
CS$graph_terms
```

## 研究主题地图

```{r}
# Thematic Map
safe_thematicMap <- purrr::possibly(thematicMap, NULL)
Map <- safe_thematicMap(df, field="ID",n=250,minfreq = 5,stemming = FALSE,size = 0.5, n.labels = 3, repel = TRUE)
Map$map
```
