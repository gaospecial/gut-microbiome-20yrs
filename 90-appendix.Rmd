\cleardoublepage 

# (APPENDIX) 附录 {-}


# 数据来源 {#data-source}


## 文献检索方式

使用“肠道”和“菌群”两个主题词在 WOS 数据库中搜索 2000 年以来的文献数据，共检得56445条记录（2020-1-3)。

其中，包括 2135 条高被引论文（Highly Cited in Field）。

- 数据库
  
  Web of Science Core Collection;
  
  包括：SCI-EXPANDED, SSCI, CPCI-S, CPCI-SSH, CCR-EXPANDED, IC.

- 检索年限
  
  从 2000 年至 2020 年；

- 具体使用的检索式是：

  "TS=(gut OR intestine OR bowel OR intestinal OR colon OR colorectal OR gastrointestine OR gastrointestinal) AND TS=(microbiome OR microbiota OR flora OR microbe OR microbes OR commensal OR symbiont OR pathobiont OR mycobiome OR virome OR metagenome OR meta-genome)"。


**Web of Science 关于高被引论文的定义**

> As of September/October 2019, this highly cited paper received enough citations to place it in the top 1% of the academic field of Agricultural Sciences based on a highly cited threshold for the field and publication year.

## 下载“肠道菌群”研究完整数据

下载完整数据（Full Record and Cited References），保存为文本文件。

Web of Science 数据导出每次限制 500 条数据，需要分多次保存，全部下载完毕后，可以将所有文件合并到一起。

```{sh eval=F}
cat export.*.txt > all.text
```


# 文献筛选


在最初阶段我们的分析依赖于全部的5万多篇文献，但是我们很快发现这个数据量在进行较复杂的分析时，一方面会导致计算量比较大，另一方面也没有必要完整覆盖。因此寻找一个方法确定核心文献十分必要。高被引论文虽然是一个备选，但是高被引论文针对的是大的学科领域，可能并不能凸显论文对道菌群研究的重要性。且我们也可以发现2009年前是没有高被引论文在这5万多篇文献中存在的，因此对于一些特别经典的菌群研究论文有所遗漏。因此我们使用**本地被引频次**这个参数对文献做了一定的筛选，即将每年本地被引频次排在前 5% 的文献作为关键文献，进行了更为充分的分析。

我们看一下本地被引频次的含义。
**本地被引频次**，即 Local Citation Score（LCS），它表示这篇文章在当前数据集中被引用的次数。
**全局引用次数**，即 Global Citation Score （GCS），它表示这篇文章被整个WOS数据库中所有文献引用的次数，也就是在 Web of Science 网站上看到的引用次数。
一篇文章GCS很高，说明被全球科学家关注较多。但是如果一篇GCS很高，而LCS很小，说明这种关注主要来自与你不是同一领域的科学家。此时，这篇文献对你的参考意义可能不大。如果 LCS 很高，则说明这篇文献与你数据集中关注的领域十分相关。所以，使用 LCS 可以快速定位一个领域的经典文献。

值得一提的是，我们按照 LCS 前 5% 筛选后得到的文献共有 `r nrow(MC)` 篇，其中覆盖了约三分之二的WoS高被引论文，比WoS高被引论文少了700多篇。不过，另外新增了约800多篇新文献（图 \@ref(fig:HC-vs-MC)）。

```{r HC-vs-MC, fig.cap="本地被引频次前5%的文献与WoS数据库高被引论文的重叠度",fig.width=8}
list <- list(HC=highly_cited$SR,MC=MC$SR)
ggVennDiagram::ggVennDiagram(list,category.names = c("WOS高被引","本地核心文献"),label="both") +
  theme(legend.position = "none")

```

图 \@ref(fig:HC-vs-MC-year) 显示这些论文的差别主要在哪些年份。

```{r HC-vs-MC-year, fig.cap="高被引和核心论文的差别"}
HC_specific <- setdiff(list$HC,list$MC)
MC_specific <- setdiff(list$MC,list$HC)

df1 <- M %>% filter(SR  %in% HC_specific ) %>% group_by(PY,DT) %>% summarise(count=-n(),type="缺少")
df2 <- M %>% filter(SR  %in% MC_specific ) %>% group_by(PY,DT) %>% summarise(count=n(),type="新增")

p <- rbind(df1,df2) %>% ggplot(aes(PY,count,fill=DT,color=type,text=paste0(type,DT,abs(count),"篇"))) + 
  geom_col() + 
  coord_flip() +
  scale_color_brewer(palette = "Set1") +
  labs(x="",y="") + 
  guides(fill=guide_legend(title = "文献类型",byrow = TRUE,ncol = 2),
         color="none") + 
  theme(legend.position = c(.8,.2)) 
plot.ly(p) %>%
  layout(showlegend=FALSE)
```


国家信息不全的文章有 `r nrow(df)` 篇，大多属于信息采集不完整的情况（表\@ref(tab:AU-CO-NA)），并非软件本身存在的错误所致。数据采集不完整的情况暂时无法解决。


```{r}
# 国家信息错误的情况
M %>% filter(str_detect(AU_CO_NR,"\\bNA\\b")) %>% 
  select(AU,SO,DT,C1,AU_CO_NR)  %>% 
  tableTag(Tag = "DT") %>%
  barplot(las=2)
```


```{r AU-CO-NA}
df <- M %>% filter(str_detect(AU_CO_NR,"\\bNA\\b")) %>% 
  select(SR,C1,AU_CO_NR) %>% 
  head(10)
kable(df,filter = "top",caption = "国家信息缺失的文献信息")
```



```{r}
# 使用自定义函数提取作者机构信息
AU_UN_wos <- function(C1,sep=";"){
  AFF <- trim(gsub("\\[.*?\\]","",C1))
  listAFF <- strsplit(AFF,sep,fixed = TRUE)
  AFFL <- lapply(listAFF,function(l){
    affL <- strsplit(l,",",fixed = TRUE)
    lapply(affL, function(x){
      return(trim(x[[1]]))
    })
  })
  AFF <- sapply(AFFL,function(x) paste0(x,collapse = sep))
  AFF <- gsub("\\&","AND",AFF)
  return(AFF)
}
```






`bibliometrix` 使用一个控制字段提取机构信息，一些机构名称不含下列控制字段，因此导致机构信息提取失败。为此，我们拟使用自定义函数改进提取机制。

```{r, echo=T,eval=F}
uTags=c("UNIV","COLL","SCH","INST","ACAD","ECOLE","CTR","SCI","CENTRE","CENTER","CENTRO","HOSP","ASSOC","COUNCIL",
          "FONDAZ","FOUNDAT","ISTIT","LAB","TECH","RES","CNR","ARCH","SCUOLA","PATENT OFF","CENT LIB","HEALTH","NATL",
          "LIBRAR","CLIN","FDN","OECD","FAC","WORLD BANK","POLITECN","INT MONETARY FUND","CLIMA","METEOR","OFFICE","ENVIR",
          "CONSORTIUM","OBSERVAT","AGRI", "MIT ", "INFN", "SUNY ")
```

改进后的机构信息提取机制更加准确。表 \@ref(tab:AU-UN-NA) 表示新旧方法得出不同机构信息字段的比较。`C1` 是作者信息字段，`AU_UN` 是 `bibliometrix` 软件提取的机构信息，`AU-UN2` 是改进提取方法后得出的机构信息。经过比较，可以发现新方法提取的信息更加准确和完整。

```{r AU-UN-NA}
set.seed(20200213)
a <- M %>% sample_n(100)
a <- metaTagExtraction(a,Field = "AU_UN")
a$AU_UN2 <- AU_UN_wos(a$C1)
a %>% filter(AU_UN != AU_UN2) %>%
  select(SR,C1,AU_UN,AU_UN2) %>%
  head(10) %>%
  kable(caption = "不同方式获取机构信息的差异")
```



